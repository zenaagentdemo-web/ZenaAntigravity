
> @zena/backend@1.0.0 test
> vitest --run src/services/property-intelligence.service.test.ts


[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90m/Users/hamishmcgee/Desktop/ZenaAntigravity/packages/backend[39m

[90mstdout[2m | src/services/property-intelligence.service.test.ts[2m > [22m[2mPropertyIntelligenceService[2m > [22m[2mrefreshIntelligence[2m > [22m[2mshould return prediction with required fields
[22m[39mprisma:error 
Invalid `prisma.propertyPrediction.upsert()` invocation in
/Users/hamishmcgee/Desktop/ZenaAntigravity/packages/backend/src/services/property-intelligence.service.ts:146:56

  143 });
  144 
  145 // Store prediction in database
â†’ 146 const stored = await prisma.propertyPrediction.upsert(
The column `milestoneForecasts` does not exist in the current database.

[90mstdout[2m | src/services/property-intelligence.service.test.ts[2m > [22m[2mPropertyIntelligenceService[2m > [22m[2mrefreshIntelligence[2m > [22m[2mshould use fallback when API key is missing
[22m[39mprisma:error 
Invalid `prisma.propertyPrediction.upsert()` invocation in
/Users/hamishmcgee/Desktop/ZenaAntigravity/packages/backend/src/services/property-intelligence.service.ts:146:56

  143 });
  144 
  145 // Store prediction in database
â†’ 146 const stored = await prisma.propertyPrediction.upsert(
The column `milestoneForecasts` does not exist in the current database.

[90mstdout[2m | src/services/property-intelligence.service.test.ts[2m > [22m[2mPropertyIntelligenceService[2m > [22m[2mrefreshIntelligence[2m > [22m[2mshould store prediction in database
[22m[39mprisma:error 
Invalid `prisma.propertyPrediction.upsert()` invocation in
/Users/hamishmcgee/Desktop/ZenaAntigravity/packages/backend/src/services/property-intelligence.service.ts:146:56

  143 });
  144 
  145 // Store prediction in database
â†’ 146 const stored = await prisma.propertyPrediction.upsert(
The column `milestoneForecasts` does not exist in the current database.

 [31mâ¯[39m src/services/property-intelligence.service.test.ts [2m([22m[2m10 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[32m 288[2mms[22m[39m
[31m       [31mÃ—[31m should return prediction with required fields[39m[32m 115[2mms[22m[39m
[31m       [31mÃ—[31m should use fallback when API key is missing[39m[32m 25[2mms[22m[39m
       [32mâœ“[39m should throw error for non-existent property[32m 15[2mms[22m[39m
[31m       [31mÃ—[31m should store prediction in database[39m[32m 23[2mms[22m[39m
       [32mâœ“[39m should return heat data[32m 16[2mms[22m[39m
       [32mâœ“[39m should return array of matches[32m 17[2mms[22m[39m
       [32mâœ“[39m should include required fields in each match[32m 20[2mms[22m[39m
       [32mâœ“[39m should return market pulse data[32m 14[2mms[22m[39m
     [32mâœ“[39m should handle property with no viewings or inquiries[32m 12[2mms[22m[39m
     [32mâœ“[39m should handle property with null optional fields[32m 10[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 3 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m src/services/property-intelligence.service.test.ts[2m > [22mPropertyIntelligenceService[2m > [22mrefreshIntelligence[2m > [22mshould return prediction with required fields
[31m[1mPrismaClientKnownRequestError[22m: 
Invalid `prisma.propertyPrediction.upsert()` invocation in
/Users/hamishmcgee/Desktop/ZenaAntigravity/packages/backend/src/services/property-intelligence.service.ts:146:56

  143 });
  144 
  145 // Store prediction in database
â†’ 146 const stored = await prisma.propertyPrediction.upsert(
The column `milestoneForecasts` does not exist in the current database.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/@prisma/client/runtime/library.js:[2m121:7315[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m PropertyIntelligenceService.refreshIntelligence src/services/property-intelligence.service.ts:[2m146:24[22m[39m
    [90m144| [39m
    [90m145| [39m        [90m// Store prediction in database[39m
    [90m146| [39m        [35mconst[39m stored [33m=[39m [35mawait[39m prisma[33m.[39mpropertyPrediction[33m.[39m[34mupsert[39m({
    [90m   | [39m                       [31m^[39m
    [90m147| [39m            where[33m:[39m { propertyId }[33m,[39m
    [90m148| [39m            update[33m:[39m {
[90m [2mâ¯[22m src/services/property-intelligence.service.test.ts:[2m93:28[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/3]â¯[22m[39m

[41m[1m FAIL [22m[49m src/services/property-intelligence.service.test.ts[2m > [22mPropertyIntelligenceService[2m > [22mrefreshIntelligence[2m > [22mshould use fallback when API key is missing
[31m[1mPrismaClientKnownRequestError[22m: 
Invalid `prisma.propertyPrediction.upsert()` invocation in
/Users/hamishmcgee/Desktop/ZenaAntigravity/packages/backend/src/services/property-intelligence.service.ts:146:56

  143 });
  144 
  145 // Store prediction in database
â†’ 146 const stored = await prisma.propertyPrediction.upsert(
The column `milestoneForecasts` does not exist in the current database.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/@prisma/client/runtime/library.js:[2m121:7315[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m PropertyIntelligenceService.refreshIntelligence src/services/property-intelligence.service.ts:[2m146:24[22m[39m
    [90m144| [39m
    [90m145| [39m        [90m// Store prediction in database[39m
    [90m146| [39m        [35mconst[39m stored [33m=[39m [35mawait[39m prisma[33m.[39mpropertyPrediction[33m.[39m[34mupsert[39m({
    [90m   | [39m                       [31m^[39m
    [90m147| [39m            where[33m:[39m { propertyId }[33m,[39m
    [90m148| [39m            update[33m:[39m {
[90m [2mâ¯[22m src/services/property-intelligence.service.test.ts:[2m108:28[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/3]â¯[22m[39m

[41m[1m FAIL [22m[49m src/services/property-intelligence.service.test.ts[2m > [22mPropertyIntelligenceService[2m > [22mrefreshIntelligence[2m > [22mshould store prediction in database
[31m[1mPrismaClientKnownRequestError[22m: 
Invalid `prisma.propertyPrediction.upsert()` invocation in
/Users/hamishmcgee/Desktop/ZenaAntigravity/packages/backend/src/services/property-intelligence.service.ts:146:56

  143 });
  144 
  145 // Store prediction in database
â†’ 146 const stored = await prisma.propertyPrediction.upsert(
The column `milestoneForecasts` does not exist in the current database.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/@prisma/client/runtime/library.js:[2m121:7315[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m PropertyIntelligenceService.refreshIntelligence src/services/property-intelligence.service.ts:[2m146:24[22m[39m
    [90m144| [39m
    [90m145| [39m        [90m// Store prediction in database[39m
    [90m146| [39m        [35mconst[39m stored [33m=[39m [35mawait[39m prisma[33m.[39mpropertyPrediction[33m.[39m[34mupsert[39m({
    [90m   | [39m                       [31m^[39m
    [90m147| [39m            where[33m:[39m { propertyId }[33m,[39m
    [90m148| [39m            update[33m:[39m {
[90m [2mâ¯[22m src/services/property-intelligence.service.test.ts:[2m144:13[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/3]â¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m7 passed[39m[22m[90m (10)[39m
[2m   Start at [22m 14:07:46
[2m   Duration [22m 1.14s[2m (transform 369ms, setup 169ms, import 340ms, tests 288ms, environment 0ms)[22m

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path /Users/hamishmcgee/Desktop/ZenaAntigravity/packages/backend
npm error workspace @zena/backend@1.0.0
npm error location /Users/hamishmcgee/Desktop/ZenaAntigravity/packages/backend
npm error command failed
npm error command sh -c vitest --run src/services/property-intelligence.service.test.ts
